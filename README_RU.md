# GBR – GitLab Branch Ruler
Утилита для автоматической защиты дефолтных веток (`master`/`main`) во всех проектах указанной группы и её подгрупп в GitLab.


## Конфигурация
Утилита читает настройки из JSON-файла (по умолчанию `config.json` или путь через флаг `-config`).

Пример `config.json`:
```json
{
  "gitlab_base_url": "https://gitlab.example.com",
  "gitlab_token": "YOUR_PERSONAL_ACCESS_TOKEN",
  "root_group_path": "myorg/backend",
  "push_access_level": 30,
  "merge_access_level": 30
}
```

- `gitlab_base_url` — GitLab URL
- `gitlab_token` — PAT с правом `api`
- `root_group_path` — полный URL-encoded путь корневой группы (например `myorg/backend/subgroup`)
- `push_access_level` — уровень доступа для `push` (например `30` для Developers)
- `merge_access_level` — уровень доступа для `merge` (например `30` для Developers)

## Сборка и запуск
В директории `./bin` лежат сборки приложения под стандартный набор ОС.

### Запуск собранного приложения
Приложение может быть запущено двумя способами:
1) **С флагом** `./app_name -config=./path/to/config.yaml` – можно указать расположение конфигурационного файла
2) **Без флага** `./app_name` – если файл конфигурации расположен в той же директории, где и исполняемый файл приложения

### Самостоятельная сборка
Для самостоятельной сборки и последующего запуска, требуется установленный **Go** версии `>=1.24.4`.

В корне репозитория находится bash-скрипт `build.sh` для сборки приложения под необходимую ОС и архитектуру.

#### Сборка под стандартный набор ОС
Скрипт можно запустить вместе с аргументами:
1) Сборка приложения под предустановленные ОС и архитектуры, а именно –> **windows amd64**; **linux amd64**;
   **macos amd64** и **arm64**
```shell
./build.sh all
```

2) Сборка приложения под конкретную ОС. Из доступных вариантов -> **windows**; **linux**, **macos**
```shell
./build.sh <ОС>
```

#### Сборка под текущую ОС
Также скрипт можно запустить без аргументов. Тогда он соберёт приложение под текущую ОС и архитектуру,
на которой был запущен скрипт:
```shell
./build.sh
```

#### Сборка под специфичную ОС
Если требуется собрать приложение под ОС или архитектуру, которой нет в стандартном наборе скрипта `build.sh`,
тогда можно посмотреть список доступных для сборки ОС и архитектуры командой:
```shell
go tool dist list
```

После чего выполнить следующую команду для сборки:

`Linux/MacOS`
```shell
env GOOS=<ОС> GOARCH=<архитектура> go build -o <название итогового файла> main.go
```

`Windows/Powershell`
```shell
$env:GOOS="<ОС>"; $env:GOARCH="<архитектура>"; go build -o <название итогового файла> main.go
```

`Windows/cmd`
```shell
set GOOS=<ОС> && set GOARCH=<архитектура> && go build -o <название итогового файла> main.go
```